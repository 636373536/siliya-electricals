<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shop - Siliya Electricals | Buy TVs, Fridges, Fans & More</title>
  <link rel="icon" href="https://i.postimg.cc/SxkDMvbZ/SE-LOGO-MCKUP.jpg" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #2da0a8;
      --primary-dark: #1a6b70;
      --secondary: #f59e0b;
      --dark: #0f172a;
      --light: #f8fafc;
      --gray: #64748b;
      --border: #e2e8f0;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,0.1);
      --transition: all 0.35s ease;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Inter', sans-serif; background:var(--light); color:var(--dark); line-height:1.6; }

    /* Navbar */
    .navbar {
      position:sticky; top:0; background:white; backdrop-filter:blur(12px); z-index:100;
      padding:1rem 2rem; box-shadow:0 2px 20px rgba(0,0,0,0.1);
    }
    .nav-container {
      max-width:1400px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1rem;
    }
    .logo { font-size:1.8rem; font-weight:700; color:var(--primary); display:flex; align-items:center; gap:12px; }
    .logo img { height:48px; border-radius:8px; }
    .nav-links { display:flex; gap:2rem; align-items:center; flex-wrap:wrap; }
    .nav-links a { color:var(--dark); text-decoration:none; font-weight:500; transition:var(--transition); }
    .nav-links a:hover { color:var(--primary); }
    .cart-icon {
      position:relative; font-size:1.5rem; color:var(--primary); cursor:pointer;
    }
    .cart-count {
      position:absolute; top:-8px; right:-10px; background:var(--secondary); color:white;
      font-size:0.75rem; width:20px; height:20px; border-radius:50%; display:grid; place-items:center; font-weight:bold;
    }
    .mobile-toggle { display:none; font-size:1.8rem; cursor:pointer; }

    /* Hero */
    .hero {
      background: linear-gradient(135deg, #141e30, #243b55); color:white; text-align:center;
      padding:5rem 1rem; border-radius:0 0 0 var(--radius) var(--radius);
    }
    .hero h1 { font-size:3rem; margin-bottom:1rem; }
    .hero p { font-size:1.3rem; max-width:700px; margin:0 auto 2rem; opacity:0.9; }
    .search-container {
      max-width:600px; margin:0 auto; position:relative;
    }
    .search-input {
      width:100%; padding:1rem 4rem 1rem 1.5rem; border-radius:50px; border:none;
      font-size:1.1rem; box-shadow:var(--shadow);
    }
    .search-btn {
      position:absolute; right:8px; top:8px; background:var(--secondary); color:white;
      border:none; width:48px; height:48px; border-radius:50%; cursor:pointer;
    }

    .container { max-width:1400px; margin:2rem auto; padding:0 1rem; }

    /* Filters */
    .filters {
      display:flex; flex-wrap:wrap; gap:1rem; justify-content:center; margin:2rem 0;
      padding:1.5rem; background:white; border-radius:var(--radius); box-shadow:var(--shadow);
    }
    .filter-select {
      padding:0.8rem 1.2rem; border:1px solid var(--border); border-radius:8px; font-size:1rem;
    }

    /* Products Grid */
    .products-grid {
      display:grid;
      grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));
      gap:2rem;
      margin:2rem 0;
    }
    .product-card {
      background:white; border-radius:var(--radius); overflow:hidden;
      box-shadow:var(--shadow); transition:var(--transition); position:relative;
    }
    .product-card:hover {
      transform:translateY(-12px); box-shadow:0 20px 40px rgba(0,0,0,0.15);
    }
    .product-badge {
      position:absolute; top:12px; left:12px; background:var(--secondary); color:white;
      padding:0.4rem 0.9rem; border-radius:50px; font-size:0.8rem; font-weight:600; z-index:5;
    }
    .out-of-stock { background:#ef4444 !important; }
    .featured { background:#10b981 !important; }

    .product-image {
      width:100%; height:280px; object-fit:cover; transition:transform 0.6s ease;
    }
    .product-card:hover .product-image { transform:scale(1.08); }

    .product-info {
      padding:1.5rem;
    }
    .product-category {
      color:var(--primary); font-size:0.9rem; font-weight:600; text-transform:uppercase; letter-spacing:1px;
    }
    .product-name {
      font-size:1.3rem; font-weight:700; margin:0.8rem 0; color:var(--dark);
    }
    .product-price {
      font-size:1.8rem; font-weight:800; color:var(--primary); margin:1rem 0;
    }
    .stock-info {
      font-size:0.95rem; color:var(--gray); margin:0.5rem 0;
    }
    .in-stock { color:#10b981; font-weight:600; }
    .out-of-stock { color:#ef4444; font-weight:600; }

    .product-actions {
      display:flex; gap:1rem; margin-top:1.5rem;
    }
    .quick-view-btn {
      background:white; color:var(--primary); border:2px solid var(--primary);
      width:50px; height:50px; border-radius:50%; display:grid; place-items:center;
      cursor:pointer; transition:var(--transition);
    }
    .quick-view-btn:hover {
      background:var(--primary); color:white;
    }
    .add-to-cart {
      flex:1; background:var(--primary); color:white; border:none;
      padding:1rem; border-radius:12px; font-weight:600; cursor:pointer;
      display:flex; align-items:center; justify-content:center; gap:8px;
    }
    .add-to-cart:hover { background:var(--primary-dark); }
    .add-to-cart:disabled {
      background:#94a3b8; cursor:not-allowed;
    }

    /* Admin Controls */
    .admin-controls {
      background:linear-gradient(135deg,#667eea,#764ba2); color:white; padding:2rem;
      border-radius:var(--radius); text-align:center; margin:2rem auto; max-width:1200px;
      box-shadow:var(--shadow);
    }
    .admin-controls button {
      background:white; color:var(--primary); border:none; padding:0.8rem 1.5rem;
      border-radius:50px; margin:0.5rem; cursor:pointer; font-weight:600;
    }

    .notification {
      position:fixed; bottom:30px; right:30px; background:#10b981; color:white;
      padding:1rem 1.5rem; border-radius:12px; box-shadow:var(--shadow);
      display:flex; align-items:center; gap:12px; z-index:1000;
      transform:translateY(100px); opacity:0; transition:0.4s;
    }
    .notification.show { transform:translateY(0); opacity:1; }
    .notification.error { background:#ef4444; }

    /* Responsive */
    @media (max-width: 992px) {
      .products-grid { grid-template-columns:repeat(auto-fill, minmax(280px,1fr)); }
    }
    @media (max-width: 768px) {
      .nav-links {
        position:fixed; top:70px; left:-100%; width:100%; background:white;
        flex-direction:column; padding:2rem; box-shadow:var(--shadow); transition:0.4s; z-index:99;
      }
      .nav-links.active { left:0; }
      .mobile-toggle { display:block; }
      .hero h1 { font-size:2.5rem; }
      .hero p { font-size:1.1rem; }
      .admin-controls { margin:1rem; padding:1.5rem; }
    }
    @media (max-width: 480px) {
      .hero h1 { font-size:2rem; }
      .search-input { padding:0.9rem 3.5rem 0.9rem 1.2rem; }
      .product-info { padding:1.2rem; }
      .product-name { font-size:1.2rem; }
      .product-price { font-size:1.6rem; }
      .notification { bottom:20px; right:20px; padding:0.8rem 1.2rem; font-size:0.9rem; }
    }
  </style>
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-container">
      <a href="index.html" class="logo">
        <img src="https://i.postimg.cc/SxkDMvbZ/SE-LOGO-MCKUP.jpg" alt="Siliya Electricals">
        Siliya Electricals
      </a>
      <div class="nav-links" id="navLinks">
        <a href="index.html">Home</a>
        <a href="shop.html">Shop</a>
        <a href="index.html#repair">Repairs</a>
        <a href="index.html#training">Training</a>
        <a href="login.html">Login</a>
        <a href="cart.html" class="cart-icon">
          Cart <span class="cart-count" id="cartCount">0</span>
        </a>
      </div>
      <div class="mobile-toggle" id="mobileToggle">Menu</div>
    </div>
  </nav>

  <!-- Hero -->
  <section class="hero">
    <h1>Premium Electrical Store</h1>
    <p>Best prices on TVs, fridges, fans, chargers, solar panels & more in Malawi</p>
    <div class="search-container">
      <input type="text" class="search-input" id="searchInput" placeholder="Search products..." />
      <button class="search-btn">Search</button>
    </div>
  </section>

  <!-- Admin Controls (Only visible to admins) -->
  <div class="admin-controls hidden" id="adminControls">
    <h2>Admin Product Management</h2>
    <button onclick="openAddProductModal()">Add New Product</button>
    <button onclick="loadProducts()">Refresh Products</button>
  </div>

  <!-- Filters -->
  <div class="container">
    <div class="filters">
      <select class="filter-select" id="categoryFilter">
        <option value="">All Categories</option>
        <option value="Televisions">Televisions</option>
        <option value="Appliances">Fridges & Freezers</option>
        <option value="Audio">Speakers & Audio</option>
        <option value="Phones">Phones & Tablets</option>
        <option value="Solar">Solar Products</option>
        <option value="Accessories">Chargers & Accessories</option>
      </select>
    </div>

    <!-- Products Grid -->
    <div class="products-grid" id="productsGrid">
      <div style="grid-column:1/-1; text-align:center; padding:4rem; color:#999;">
        <i class="fas fa-spinner fa-spin fa-3x"></i>
        <p>Loading products...</p>
      </div>
    </div>
  </div>

  <!-- Notification -->
  <div class="notification" id="notification">
    <span id="notificationText">Added to cart!</span>
  </div>

  <!-- Quick View Modal -->
  <div class="modal" id="quickViewModal" style="display:none;"></div>

  <!-- Add/Edit Product Modal (Admin Only) -->
  <div class="modal" id="addProductModal" style="display:none;">
    <div style="background:white; padding:2rem; border-radius:16px; max-width:600px; margin:2rem auto;">
      <h2 id="modalTitle">Add New Product</h2>
      <form id="productForm">
        <input type="hidden" id="editId" />
        <input type="text" id="pName" placeholder="Product Name" required style="width:100%; padding:1rem; margin:0.5rem 0; border-radius:8px; border:1px solid #ddd;" />
        <input type="text" id="pBrand" placeholder="Brand" style="width:100%; padding:1rem; margin:0.5rem 0; border-radius:8px; border:1px solid #ddd;" />
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:1rem;">
          <input type="number" id="pPrice" placeholder="Price (MWK)" required />
          <input type="number" id="pStock" placeholder="Stock" required />
        </div>
        <select id="pCategory" required style="width:100%; padding:1rem; margin:1rem 0; border-radius:8px;">
          <option value="">Select Category</option>
          <option>Televisions</option><option>Appliances</option><option>Audio</option>
          <option>Phones</option><option>Solar</option><option>Accessories</option>
        </select>
        <textarea id="pDesc" rows="4" placeholder="Description" required style="width:100%; padding:1rem; border-radius:8px; border:1px solid #ddd;"></textarea>
        <input type="file" id="pImage" accept="image/*" style="margin:1rem 0;" />
        <label><input type="checkbox" id="pFeatured" /> Featured Product</label>
        <div style="margin-top:2rem; text-align:right;">
          <button type="button" onclick="document.getElementById('addProductModal').style.display='none'" style="padding:0.8rem 1.5rem; background:#e2e8f0; border:none; border-radius:8px; margin-right:1rem;">Cancel</button>
          <button type="submit" style="padding:0.8rem 2rem; background:var(--primary); color:white; border:none; border-radius:8px;">Save</button>
        </div>
      </form>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    const BASE_URL = "https://siliya-electricals.onrender.com";
    let products = [];
    let isAdmin = false;

    // Check if admin
    async function checkAdmin() {
      const token = localStorage.getItem('token');
      if (!token) return;
      try {
        const res = await fetch(`${BASE_URL}/api/auth/profile`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        if (res.ok) {
          const user = await res.json();
          if (user.role === 'admin' || (user.data && user.data.role === 'admin')) {
            isAdmin = true;
            document.getElementById('adminControls').classList.remove('hidden');
          }
        }
      } catch(e) {}
    }

    // Load products
    async function loadProducts() {
      fetch(`${BASE_URL}/api/products`)
        .then(r => r.json())
        .then(data => {
          products = Array.isArray(data) ? data : data.data || [];
          renderProducts(products);
        })
        .catch(() => {
          document.getElementById('productsGrid').innerHTML = `<p style="text-align:center;color:#ef4444;">Failed to load products</p>`;
        });
    }

    // Render products
    function renderProducts(list) {
      const grid = document.getElementById('productsGrid');
      if (list.length === 0) {
        grid.innerHTML = `<div style="grid-column:1/-1;text-align:center;padding:4rem;color:#999;">No products found</div>`;
        return;
      }
      grid.innerHTML = list.map(p => `
        <div class="product-card">
          ${p.stock === 0 ? '<div class="product-badge out-of-stock">Out of Stock</div>' : ''}
          ${p.featured ? '<div class="product-badge featured">Featured</div>' : ''}
          <img src="${p.image || 'assets/default-product.png'}" alt="${p.name}" class="product-image" />
          <div class="product-info">
            <div class="product-category">${p.category || 'Uncategorized'}</div>
            <h3 class="product-name">${p.name}</h3>
            ${p.brand ? `<p style="margin:0.5rem 0;color:#666;"><strong>Brand:</strong> ${p.brand}</p>` : ''}
            <div class="product-price">MWK ${Number(p.price).toLocaleString()}</div>
            <div class="stock-info ${p.stock > 0 ? 'in-stock' : 'out-of-stock'}">
              ${p.stock > 0 ? p.stock + ' in stock' : 'Out of stock'}
            </div>
            <div class="product-actions">
              <button class="quick-view-btn" onclick="quickView('${p._id}')">View</button>
              <button class="add-to-cart" onclick="addToCart('${p._id}', '${p.name}')" ${p.stock===0?'disabled':''}>
                ${p.stock===0?'Sold Out':'Add to Cart'}
              </button>
            </div>
            ${isAdmin ? `<div style="margin-top:1rem;display:flex;gap:0.5rem;">
              <button onclick="editProduct('${p._id}')" style="flex:1;padding:0.6rem;background:#e0e7ff;border:none;border-radius:8px;">Edit</button>
              <button onclick="deleteProduct('${p._id}')" style="padding:0.6rem 1rem;background:#fee2e2;border:none;border-radius:8px;">Delete</button>
            </div>` : ''}
          </div>
        </div>
      `).join('');
    }

    // Search & Filter
    document.getElementById('searchInput').addEventListener('input', () => {
      const term = document.getElementById('searchInput').value.toLowerCase();
      const cat = document.getElementById('categoryFilter').value;
      let filtered = products;
      if (term) filtered = filtered.filter(p => p.name.toLowerCase().includes(term) || p.description?.toLowerCase().includes(term));
      if (cat) filtered = filtered.filter(p => p.category === cat);
      renderProducts(filtered);
    });
    document.getElementById('categoryFilter').addEventListener('change', () => document.getElementById('searchInput').dispatchEvent(new Event('input')));

    // Add to Cart
    function addToCart(id, name) {
      let cart = JSON.parse(localStorage.getItem('cart') || '[]');
      const item = cart.find(x => x.id === id);
      if (item) item.qty += 1;
      else cart.push({id, name, qty: 1});
      localStorage.setItem('cart', JSON.stringify(cart));
      document.getElementById('cartCount').textContent = cart.reduce((a,c)=>a+c.qty,0);
      document.getElementById('notificationText').textContent = `"${name}" added to cart!`;
      document.getElementById('notification').classList.add('show');
      setTimeout(() => document.getElementById('notification').classList.remove('show'), 3000);
    }

    // Quick View
    function quickView(id) {
      const p = products.find(x => x._id === id);
      document.getElementById('quickViewModal').style.display = 'block';
      document.getElementById('quickViewModal').innerHTML = `
        <div style="background:white;padding:2rem;border-radius:16px;max-width:900px;margin:5% auto;position:relative;">
          <button onclick="this.parentElement.parentElement.style.display='none'" style="position:absolute;top:15px;right:20px;background:none;border:none;font-size:2rem;cursor:pointer;">x</button>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:2rem;">
            <img src="${p.image}" style="width:100%;border-radius:12px;">
            <div>
              <h2>${p.name}</h2>
              <p><strong>Category:</strong> ${p.category}</p>
              <p>${p.description}</p>
              <h2 style="color:var(--primary);margin:1rem 0;">MWK ${Number(p.price).toLocaleString()}</p>
              <p><strong>Stock:</strong> <span style="color:${p.stock>0?'green':'red'}">${p.stock>0?p.stock+' available':'Out of stock'}</span></p>
              <button onclick="addToCart('${p._id}','${p.name}');this.parentElement.parentElement.style.display='none'" 
                style="width:100%;padding:1rem;background:var(--primary);color:white;border:none;border-radius:12px;margin-top:1rem;">
                Add to Cart
              </button>
            </div>
          </div>
        </div>
      `;
    }

    // Mobile menu
    document.getElementById('mobileToggle').addEventListener('click', () => {
      document.getElementById('navLinks').classList.toggle('active');
    });

    // Init
    checkAdmin();
    loadProducts();
    const cart = JSON.parse(localStorage.getItem('cart') || '[]');
    document.getElementById('cartCount').textContent = cart.reduce((a,c)=>a+c.qty,0);
  </script>
</body>
</html>