<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop Premium Electricals - Siliya Electricals</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styleslll.css">
    <style>
        :root {
            --primary: #0e174e;
            --primary-dark: #1d4ed8;
            --secondary: #f59e0b;
            --light: #f8fafc;
            --dark: #1e293b;
            --success: #10b981;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --transition: all 0.3s ease;
        }header {
    background: var(--light);
    box-shadow: var(--shadow);
}
/* Admin Controls */
.admin-controls {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: white;
  padding: 1.5rem;
  margin: 1rem auto;
  border-radius: var(--radius);
  max-width: 1200px;
}

.admin-controls.hidden {
  display: none;
}

.admin-panel h3 {
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.admin-actions {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

/* Admin Product Badge */
.admin-product-badge {
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 20;
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.admin-badge {
  background: #f59e0b;
  color: white;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.7rem;
  font-weight: 600;
}

.admin-product-actions {
  display: flex;
  gap: 0.25rem;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.product-card:hover .admin-product-actions {
  opacity: 1;
}

.admin-action-btn {
  width: 30px;
  height: 30px;
  border: none;
  border-radius: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 0.8rem;
  transition: all 0.3s ease;
}

.admin-action-btn.edit-btn {
  background: var(--primary);
  color: white;
}

.admin-action-btn.delete-btn {
  background: #ef4444;
  color: white;
}

.admin-action-btn:hover {
  transform: scale(1.1);
}

/* Admin Overlay Button */
.admin-overlay-btn {
  background: rgba(255, 255, 255, 0.9);
  color: var(--dark);
  border: none;
  padding: 0.5rem 1rem;
  border-radius: 50px;
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  margin-top: 0.5rem;
}

.admin-overlay-btn:hover {
  background: white;
  transform: translateY(-2px);
}

/* Admin Product Info */
.product-admin-info {
  background: #f8fafc;
  padding: 0.75rem;
  border-radius: 8px;
  margin: 1rem 0;
  border-left: 3px solid var(--primary);
}

.stock-info {
  display: flex;
  justify-content: between;
  align-items: center;
  margin-bottom: 0.5rem;
}

.stock-label {
  font-weight: 600;
  color: var(--gray);
}

.stock-value {
  font-weight: 700;
  margin-left: auto;
}

.stock-value.in-stock { color: var(--success); }
.stock-value.low-stock { color: var(--warning); }
.stock-value.out-of-stock { color: var(--danger); }

.product-status {
  display: flex;
  gap: 0.5rem;
  font-size: 0.8rem;
}

.status {
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
  font-weight: 600;
}

.status.active {
  background: var(--success);
  color: white;
}

.status.inactive {
  background: var(--gray);
  color: white;
}

.featured-tag {
  background: var(--primary);
  color: white;
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
  font-weight: 600;
}

/* File Upload Styles */
.file-upload-container {
  position: relative;
}

.file-upload-preview {
  border: 2px dashed var(--gray-light);
  border-radius: var(--radius);
  padding: 2rem;
  text-align: center;
  cursor: pointer;
  transition: var(--transition);
  background: #fafafa;
}

.file-upload-preview:hover {
  border-color: var(--primary);
  background: #f0f9ff;
}

.file-upload-preview.has-image {
  padding: 0;
  border: none;
}

.file-upload-preview img {
  width: 100%;
  height: 200px;
  object-fit: cover;
  border-radius: var(--radius);
}

.file-upload-container input[type="file"] {
  position: absolute;
  width: 0;
  height: 0;
  opacity: 0;
}

/* Modal Tabs */
.modal-tabs {
  display: flex;
  border-bottom: 1px solid var(--gray-light);
  margin-bottom: 1.5rem;
}

.tab-btn {
  padding: 0.75rem 1.5rem;
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  cursor: pointer;
  font-weight: 500;
  transition: var(--transition);
}

.tab-btn.active {
  border-bottom-color: var(--primary);
  color: var(--primary);
}

.tab-content {
  display: none;
}

.tab-content.active {
  display: block;
}

/* Notification Items */
.notification-item {
  background: white;
  border-radius: var(--radius);
  padding: 1.5rem;
  margin-bottom: 1rem;
  box-shadow: var(--shadow-sm);
  border-left: 4px solid var(--primary);
}

.notification-item.active {
  border-left-color: var(--success);
}

.notification-item.inactive {
  border-left-color: var(--gray);
}

.notification-header {
  display: flex;
  justify-content: between;
  align-items: start;
  margin-bottom: 1rem;
}

.notification-title {
  flex: 1;
}

.notification-title h5 {
  margin: 0 0 0.5rem 0;
  color: var(--dark);
}

.notification-type {
  padding: 0.25rem 0.75rem;
  border-radius: 50px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
}

.notification-type.info { background: var(--primary); color: white; }
.notification-type.warning { background: var(--warning); color: white; }
.notification-type.success { background: var(--success); color: white; }
.notification-type.error { background: var(--danger); color: white; }

.notification-body p {
  margin: 0;
  color: var(--gray);
  line-height: 1.5;
}

.notification-footer {
  display: flex;
  justify-content: between;
  align-items: center;
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid var(--gray-light);
}

.notification-meta {
  display: flex;
  gap: 1rem;
  font-size: 0.8rem;
  color: var(--gray);
}

.notification-actions {
  display: flex;
  gap: 0.5rem;
}

/* Empty and Error States */
.empty-state, .error-state {
  text-align: center;
  padding: 3rem 2rem;
  color: var(--gray);
}

.empty-state i, .error-state i {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

.error-state i {
  color: var(--danger);
}

/* Quick View Modal */
.quick-view-content {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 2rem;
}

.product-image-large img {
  width: 100%;
  height: 300px;
  object-fit: cover;
  border-radius: var(--radius);
}

.product-details h2 {
  margin: 0 0 0.5rem 0;
  color: var(--dark);
}

.product-price-large {
  font-size: 2rem;
  font-weight: 700;
  color: var(--primary);
  margin: 1rem 0;
}

.stock-info-large {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 1rem 0;
  padding: 1rem;
  background: #f8fafc;
  border-radius: var(--radius);
}

.stock-value.in-stock { color: var(--success); }
.stock-value.out-of-stock { color: var(--danger); }

.product-actions-large {
  display: flex;
  gap: 1rem;
  margin: 1.5rem 0;
}

.add-cart-btn-large {
  flex: 1;
  background: var(--primary);
  color: white;
  border: none;
  padding: 1rem 1.5rem;
  border-radius: var(--radius);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.add-cart-btn-large:hover:not(:disabled) {
  background: var(--primary-dark);
  transform: translateY(-2px);
}

.add-cart-btn-large:disabled {
  background: var(--gray-light);
  color: var(--gray);
  cursor: not-allowed;
}

.wishlist-btn-large {
  background: white;
  color: var(--dark);
  border: 1px solid var(--gray-light);
  padding: 1rem 1.5rem;
  border-radius: var(--radius);
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.wishlist-btn-large:hover {
  border-color: var(--primary);
  color: var(--primary);
}

.admin-actions-quick {
  margin-top: 1rem;
  padding-top: 1rem;
  border-top: 1px solid var(--gray-light);
}

/* Responsive Design */
@media (max-width: 768px) {
  .quick-view-content {
    grid-template-columns: 1fr;
  }
  
  .notification-footer {
    flex-direction: column;
    gap: 1rem;
    align-items: flex-start;
  }
  
  .notification-actions {
    width: 100%;
    justify-content: space-between;
  }
  
  .admin-actions {
    flex-direction: column;
  }
  
  .product-admin-info {
    flex-direction: column;
    gap: 0.5rem;
  }
}

@media (max-width: 480px) {
  .modal-content {
    margin: 1rem;
    width: calc(100% - 2rem);
  }
  
  .form-row {
    grid-template-columns: 1fr;
  }
  
  .product-actions-large {
    flex-direction: column;
  }
}
.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 1.5rem;
}

.logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--primary);
}

.logo img {
    height: 40px;
    width: auto;
}

nav ul {
    display: flex;
    align-items: center;
    gap: 1rem;
    list-style: none;
    margin: 0;
    padding: 0;
}

.cart-icon {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    color: var(--primary);
    font-size: 1.2rem;
}

.cart-icon:hover {
    color: var(--primary-dark);
}

        .hero-section {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 3rem 0;
            margin-bottom: 3rem;
            border-radius: 0 0 var(--radius) var(--radius);
        }

        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
            text-align: center;
        }

        .hero-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .hero-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .search-container {
            max-width: 600px;
            margin: 0 auto 2rem;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            border: none;
            font-size: 1rem;
            box-shadow: var(--shadow);
        }

        .search-button {
            position: absolute;
            right: 8px;
            top: 8px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .search-button:hover {
            background: var(--primary-dark);
        }

        .filter-section {
            background: white;
            padding: 1.5rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            box-shadow: var(--shadow);
        }

        .filter-select {
            padding: 0.75rem 1rem;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            background: white;
            font-size: 0.9rem;
            min-width: 180px;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .results-count {
            margin-left: auto;
            color: var(--gray);
            font-weight: 500;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .product-card {
            background: white;
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .product-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: var(--secondary);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 50px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 10;
        }

        .product-image-container {
            position: relative;
            overflow: hidden;
            height: 220px;
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .product-card:hover .product-image {
            transform: scale(1.05);
        }

        .product-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            padding: 1rem;
            opacity: 0;
            transition: var(--transition);
        }

        .product-card:hover .product-overlay {
            opacity: 1;
        }

        .quick-view-btn {
            background: white;
            color: var(--dark);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .quick-view-btn:hover {
            background: var(--primary);
            color: white;
        }

        .product-info {
            padding: 1.5rem;
        }

        .product-category {
            color: var(--primary);
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            display: block;
        }

        .product-name {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            color: var(--dark);
            line-height: 1.4;
        }

        .product-description {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-price {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        .product-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--gray-light);
        }

        .product-stock {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .product-stock.in-stock {
            color: var(--success);
        }

        .product-actions {
            display: flex;
            gap: 0.5rem;
        }

        .wishlist-btn {
            background: var(--gray-light);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .wishlist-btn:hover {
            background: #fee2e2;
            color: #ef4444;
        }

        .add-cart-btn {
            flex: 1;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius);
            padding: 0.5rem 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .add-cart-btn:hover {
            background: var(--primary-dark);
        }

        .add-cart-btn:disabled {
            background: var(--gray-light);
            color: var(--gray);
            cursor: not-allowed;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin: 3rem 0;
            gap: 0.5rem;
        }

        .pagination-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            border: 1px solid var(--gray-light);
            background: white;
            color: var(--dark);
            cursor: pointer;
            transition: var(--transition);
        }

        .pagination-btn:hover, .pagination-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            padding: 3rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--gray-light);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
        }

        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-error {
            background: #ef4444;
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-select {
                width: 100%;
            }
            
            .results-count {
                margin-left: 0;
                text-align: center;
            }
            
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1.5rem;
            }
        }

        @media (max-width: 480px) {
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .hero-title {
                font-size: 1.75rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <img src="assets/logo.png" alt="Siliya Electricals">
                <span>Siliya Electricals</span>
            </div>
            <nav>
                <ul>

                    <li class="cart-icon" onclick="window.location.href='cart.html'">
                        <i class="fas fa-shopping-cart"></i>
                        <span class="cart-count">0</span>
                    </li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="hero-section">
        <div class="hero-content">
            <h1 class="hero-title">Premium Electrical Appliances</h1>
            <p class="hero-subtitle">Discover the latest in home electronics with guaranteed quality and affordable prices</p>
            
            <div class="search-container">
                <input type="text" class="search-input" id="search-input" placeholder="Search for products...">
                <button class="search-button">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </div>
    <!-- Add this after the hero section in shop.html -->
<div id="adminControls" class="admin-controls hidden">
    <div class="admin-panel">
      <h3><i class="fas fa-cog"></i> Admin Product Management</h3>
      <div class="admin-actions">
        <button class="btn btn-primary" onclick="openAddProductModal()">
          <i class="fas fa-plus"></i> Add New Product
        </button>
        <button class="btn btn-outline" onclick="refreshProducts()">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
        <button class="btn btn-outline" onclick="exportProducts()">
          <i class="fas fa-download"></i> Export Products
        </button>
      </div>
    </div>
  </div>
  
  <!-- Add Product Modal -->
  <div class="modal" id="addProductModal">
    <div class="modal-content" style="max-width: 700px;">
      <header class="modal-header">
        <h3><i class="fas fa-plus-circle"></i> Add New Product</h3>
        <button class="close-btn" onclick="closeModal('addProductModal')">√ó</button>
      </header>
      <div class="modal-body">
        <form id="addProductForm" enctype="multipart/form-data">
          <div class="form-row">
            <div class="form-group">
              <label for="productName">Product Name *</label>
              <input type="text" id="productName" name="name" placeholder="Enter product name" required>
            </div>
            <div class="form-group">
              <label for="productCategory">Category *</label>
              <select id="productCategory" name="category" required>
                <option value="">Select Category</option>
                <option value="Televisions">üì∫ Televisions</option>
                <option value="Appliances">üè† Home Appliances</option>
                <option value="Audio">üîä Audio Systems</option>
                <option value="Computing">üíª Computing</option>
                <option value="Phones">üì± Phones & Tablets</option>
                <option value="Accessories">üîå Accessories</option>
              </select>
            </div>
          </div>
          
          <div class="form-group">
            <label for="productDescription">Description *</label>
            <textarea id="productDescription" name="description" placeholder="Enter product description" rows="3" required></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="productPrice">Price (MK) *</label>
              <input type="number" id="productPrice" name="price" placeholder="0.00" min="0" step="0.01" required>
            </div>
            <div class="form-group">
              <label for="productStock">Stock Quantity *</label>
              <input type="number" id="productStock" name="stock" placeholder="0" min="0" required>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="productBrand">Brand</label>
              <input type="text" id="productBrand" name="brand" placeholder="Product brand">
            </div>
            <div class="form-group">
              <label for="productModel">Model</label>
              <input type="text" id="productModel" name="model" placeholder="Product model">
            </div>
          </div>
          
          <div class="form-group">
            <label for="productImage">Product Image *</label>
            <div class="file-upload-container">
              <input type="file" id="productImage" name="image" accept="image/*" required>
              <div class="file-upload-preview" id="imagePreview">
                <i class="fas fa-image"></i>
                <span>Click to upload product image</span>
              </div>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="productFeatured" name="featured">
                <span class="checkmark"></span>
                Feature this product
              </label>
            </div>
            <div class="form-group">
              <label class="checkbox-label">
                <input type="checkbox" id="productActive" name="active" checked>
                <span class="checkmark"></span>
                Active product
              </label>
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" class="btn btn-outline" onclick="closeModal('addProductModal')">Cancel</button>
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save"></i> Save Product
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Product Management Modal -->
  <div class="modal" id="manageProductsModal">
    <div class="modal-content" style="max-width: 900px;">
      <header class="modal-header">
        <h3><i class="fas fa-boxes"></i> Manage Products</h3>
        <button class="close-btn" onclick="closeModal('manageProductsModal')">√ó</button>
      </header>
      <div class="modal-body">
        <div class="products-management-tools">
          <div class="search-box">
            <input type="text" id="manageProductsSearch" placeholder="Search products...">
            <i class="fas fa-search"></i>
          </div>
          <div class="filter-options">
            <select id="categoryFilterManage">
              <option value="">All Categories</option>
              <option value="Televisions">Televisions</option>
              <option value="Appliances">Appliances</option>
              <option value="Audio">Audio</option>
              <option value="Computing">Computing</option>
              <option value="Phones">Phones</option>
            </select>
          </div>
        </div>
        
        <div class="products-list" id="manageProductsList">
          <!-- Products will be loaded here -->
        </div>
      </div>
    </div>
  </div>
    <footer>
        <div class="footer-content">
            <p>&copy; 2024 Siliya Electricals. All rights reserved.</p>
        </div>
    </footer>

    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">Product added to cart!</span>
    </div>

    <script>
 // Admin Product Management Functions
let isAdmin = false;
let allProducts = [];

// Check if user is admin and show admin controls
async function checkAdminStatus() {
  try {
    const token = localStorage.getItem('token');
    if (!token) return;
    
    const response = await fetch('/api/auth/profile', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    if (response.ok) {
      const userData = await response.json();
      const user = userData.data || userData;
      
      if (user.role === 'admin') {
        isAdmin = true;
        document.getElementById('adminControls').classList.remove('hidden');
        setupAdminProductManagement();
      }
    }
  } catch (error) {
    console.error('Error checking admin status:', error);
  }
}

// Setup admin product management
function setupAdminProductManagement() {
  // Add admin controls to product cards
  document.addEventListener('click', function(e) {
    if (e.target.closest('.admin-product-actions')) {
      e.stopPropagation();
    }
  });
}

// Open add product modal
function openAddProductModal() {
  document.getElementById('addProductModal').classList.add('active');
  setupImagePreview();
}

// Setup image preview for product upload
function setupImagePreview() {
  const imageInput = document.getElementById('productImage');
  const preview = document.getElementById('imagePreview');
  
  imageInput.addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
        preview.classList.add('has-image');
      };
      reader.readAsDataURL(file);
    }
  });
  
  preview.addEventListener('click', function() {
    imageInput.click();
  });
}

// Handle product form submission
document.getElementById('addProductForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const submitBtn = this.querySelector('button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  
  try {
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
    submitBtn.disabled = true;
    
    const formData = new FormData(this);
    
    // Add checkbox values
    formData.append('featured', document.getElementById('productFeatured').checked);
    formData.append('active', document.getElementById('productActive').checked);
    
    const token = localStorage.getItem('token');
    const response = await fetch('/api/products', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`
        // Note: Don't set Content-Type for FormData, let browser set it
      },
      body: formData
    });
    
    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.message || 'Failed to create product');
    }
    
    const result = await response.json();
    
    showToast('‚úÖ Product added successfully!', 'success');
    
    // Reset form and close modal
    this.reset();
    document.getElementById('imagePreview').innerHTML = `
      <i class="fas fa-image"></i>
      <span>Click to upload product image</span>
    `;
    document.getElementById('imagePreview').classList.remove('has-image');
    
    closeModal('addProductModal');
    
    // Refresh products list
    await loadProducts();
    
  } catch (error) {
    console.error('Error creating product:', error);
    showToast(`‚ùå Failed to add product: ${error.message}`, 'error');
  } finally {
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
});

// Enhanced product card rendering with admin actions
function renderProductsWithAdmin(productsToShow) {
  if (productsToShow.length === 0) {
    productsContainer.innerHTML = `
      <div class="no-products" style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
        <i class="fas fa-search" style="font-size: 3rem; color: var(--gray-light); margin-bottom: 1rem;"></i>
        <h3>No products found</h3>
        <p>Try adjusting your filters or search terms</p>
        ${isAdmin ? `<button class="btn btn-primary" onclick="openAddProductModal()">Add First Product</button>` : ''}
      </div>
    `;
    return;
  }
  
  productsContainer.innerHTML = productsToShow.map(product => `
    <div class="product-card" data-product-id="${product._id}">
      ${isAdmin ? `
        <div class="admin-product-badge">
          <span class="admin-badge">ADMIN</span>
          <div class="admin-product-actions">
            <button class="admin-action-btn edit-btn" onclick="editProduct('${product._id}')" title="Edit Product">
              <i class="fas fa-edit"></i>
            </button>
            <button class="admin-action-btn delete-btn" onclick="deleteProduct('${product._id}')" title="Delete Product">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      ` : ''}
      
      ${product.stock < 5 && product.stock > 0 ? 
        `<div class="product-badge">Low Stock</div>` : 
        product.stock === 0 ? 
        `<div class="product-badge" style="background: #ef4444;">Out of Stock</div>` : 
        product.featured ? 
        `<div class="product-badge" style="background: var(--success);">Featured</div>` : ''
      }
      
      <div class="product-image-container">
        <img src="${product.image || 'assets/default-product.png'}" alt="${product.name}" class="product-image">
        <div class="product-overlay">
          <button class="quick-view-btn" onclick="quickViewProduct('${product._id}')">
            <i class="fas fa-eye"></i> Quick View
          </button>
          ${isAdmin ? `
            <button class="admin-overlay-btn" onclick="editProduct('${product._id}')">
              <i class="fas fa-cog"></i> Manage
            </button>
          ` : ''}
        </div>
      </div>
      
      <div class="product-info">
        <span class="product-category">${product.category}</span>
        <h3 class="product-name">${product.name}</h3>
        <p class="product-description">${product.description}</p>
        
        <div class="product-price">MK${product.price.toLocaleString()}</div>
        
        ${isAdmin ? `
          <div class="product-admin-info">
            <div class="stock-info">
              <span class="stock-label">Stock:</span>
              <span class="stock-value ${product.stock === 0 ? 'out-of-stock' : product.stock < 10 ? 'low-stock' : 'in-stock'}">
                ${product.stock}
              </span>
            </div>
            <div class="product-status">
              <span class="status ${product.active ? 'active' : 'inactive'}">
                ${product.active ? 'Active' : 'Inactive'}
              </span>
              ${product.featured ? '<span class="featured-tag">Featured</span>' : ''}
            </div>
          </div>
        ` : ''}
        
        <div class="product-meta">
          <div class="product-stock ${product.stock > 0 ? 'in-stock' : ''}">
            ${product.stock > 0 ? `${product.stock} in stock` : 'Out of stock'}
          </div>
          
          <div class="product-actions">
            <button class="wishlist-btn">
              <i class="far fa-heart"></i>
            </button>
            
            <button class="add-cart-btn" onclick="addToCart('${product._id}')" 
              ${product.stock === 0 ? 'disabled' : ''}>
              <i class="fas fa-shopping-cart"></i>
              ${product.stock === 0 ? 'Out of Stock' : 'Add to Cart'}
            </button>
          </div>
        </div>
      </div>
    </div>
  `).join('');
}

// Edit product function
async function editProduct(productId) {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch(`/api/products/${productId}`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    if (!response.ok) throw new Error('Failed to load product');
    
    const data = await response.json();
    const product = data.data?.product || data;
    
    // Pre-fill the form with product data
    document.getElementById('productName').value = product.name;
    document.getElementById('productDescription').value = product.description;
    document.getElementById('productPrice').value = product.price;
    document.getElementById('productStock').value = product.stock;
    document.getElementById('productCategory').value = product.category;
    document.getElementById('productBrand').value = product.brand || '';
    document.getElementById('productModel').value = product.model || '';
    document.getElementById('productFeatured').checked = product.featured || false;
    document.getElementById('productActive').checked = product.active !== false;
    
    // Set image preview if exists
    if (product.image) {
      const preview = document.getElementById('imagePreview');
      preview.innerHTML = `<img src="${product.image}" alt="Preview">`;
      preview.classList.add('has-image');
    }
    
    // Change form to edit mode
    const form = document.getElementById('addProductForm');
    form.setAttribute('data-edit-id', productId);
    form.querySelector('button[type="submit"]').innerHTML = '<i class="fas fa-save"></i> Update Product';
    
    // Change modal title
    document.querySelector('#addProductModal .modal-header h3').innerHTML = '<i class="fas fa-edit"></i> Edit Product';
    
    openAddProductModal();
    
  } catch (error) {
    console.error('Error loading product for edit:', error);
    showToast('‚ùå Failed to load product for editing', 'error');
  }
}

// Delete product function
async function deleteProduct(productId) {
  if (!confirm('Are you sure you want to delete this product? This action cannot be undone.')) {
    return;
  }
  
  try {
    const token = localStorage.getItem('token');
    const response = await fetch(`/api/products/${productId}`, {
      method: 'DELETE',
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    if (!response.ok) throw new Error('Failed to delete product');
    
    showToast('‚úÖ Product deleted successfully!', 'success');
    await loadProducts();
    
  } catch (error) {
    console.error('Error deleting product:', error);
    showToast('‚ùå Failed to delete product', 'error');
  }
}

// Update product form submission for edits
document.getElementById('addProductForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  const productId = this.getAttribute('data-edit-id');
  if (productId) {
    // This is an edit operation
    await updateProduct(productId);
    return;
  }
  
  // Otherwise, it's a create operation (handled above)
});

// Update product function
async function updateProduct(productId) {
  const submitBtn = document.querySelector('#addProductForm button[type="submit"]');
  const originalText = submitBtn.innerHTML;
  
  try {
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
    submitBtn.disabled = true;
    
    const formData = new FormData(document.getElementById('addProductForm'));
    formData.append('featured', document.getElementById('productFeatured').checked);
    formData.append('active', document.getElementById('productActive').checked);
    
    const token = localStorage.getItem('token');
    const response = await fetch(`/api/products/${productId}`, {
      method: 'PATCH',
      headers: {
        'Authorization': `Bearer ${token}`
      },
      body: formData
    });
    
    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(errorData.message || 'Failed to update product');
    }
    
    showToast('‚úÖ Product updated successfully!', 'success');
    
    // Reset form and close modal
    document.getElementById('addProductForm').reset();
    document.getElementById('addProductForm').removeAttribute('data-edit-id');
    document.querySelector('#addProductModal .modal-header h3').innerHTML = '<i class="fas fa-plus-circle"></i> Add New Product';
    submitBtn.innerHTML = '<i class="fas fa-save"></i> Save Product';
    
    closeModal('addProductModal');
    
    // Refresh products list
    await loadProducts();
    
  } catch (error) {
    console.error('Error updating product:', error);
    showToast(`‚ùå Failed to update product: ${error.message}`, 'error');
  } finally {
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;
  }
}

// Quick view product
async function quickViewProduct(productId) {
  try {
    const response = await fetch(`/api/products/${productId}`);
    if (!response.ok) throw new Error('Failed to load product');
    
    const data = await response.json();
    const product = data.data?.product || data;
    
    // Create quick view modal
    const modalHTML = `
      <div class="modal" id="quickViewModal">
        <div class="modal-content" style="max-width: 800px;">
          <header class="modal-header">
            <h3>Product Details</h3>
            <button class="close-btn" onclick="closeModal('quickViewModal')">√ó</button>
          </header>
          <div class="modal-body">
            <div class="quick-view-content">
              <div class="product-image-large">
                <img src="${product.image || 'assets/default-product.png'}" alt="${product.name}">
              </div>
              <div class="product-details">
                <h2>${product.name}</h2>
                <span class="product-category">${product.category}</span>
                <p class="product-description-full">${product.description}</p>
                
                <div class="product-price-large">MK${product.price.toLocaleString()}</div>
                
                ${product.brand ? `<p><strong>Brand:</strong> ${product.brand}</p>` : ''}
                ${product.model ? `<p><strong>Model:</strong> ${product.model}</p>` : ''}
                
                <div class="stock-info-large">
                  <span class="stock-label">Availability:</span>
                  <span class="stock-value ${product.stock > 0 ? 'in-stock' : 'out-of-stock'}">
                    ${product.stock > 0 ? `${product.stock} items in stock` : 'Out of stock'}
                  </span>
                </div>
                
                <div class="product-actions-large">
                  <button class="add-cart-btn-large" onclick="addToCart('${product._id}')" 
                    ${product.stock === 0 ? 'disabled' : ''}>
                    <i class="fas fa-shopping-cart"></i>
                    Add to Cart - MK${product.price.toLocaleString()}
                  </button>
                  <button class="wishlist-btn-large">
                    <i class="far fa-heart"></i> Add to Wishlist
                  </button>
                </div>
                
                ${isAdmin ? `
                  <div class="admin-actions-quick">
                    <button class="btn btn-outline" onclick="editProduct('${product._id}')">
                      <i class="fas fa-edit"></i> Edit Product
                    </button>
                  </div>
                ` : ''}
              </div>
            </div>
          </div>
        </div>
      </div>
    `;
    
    // Remove existing modal if any
    const existingModal = document.getElementById('quickViewModal');
    if (existingModal) existingModal.remove();
    
    document.body.insertAdjacentHTML('beforeend', modalHTML);
    document.getElementById('quickViewModal').classList.add('active');
    
  } catch (error) {
    console.error('Error in quick view:', error);
    showToast('‚ùå Failed to load product details', 'error');
  }
}

// Refresh products
async function refreshProducts() {
  await loadProducts();
  showToast('üîÑ Products list refreshed', 'success');
}

// Export products
async function exportProducts() {
  try {
    const token = localStorage.getItem('token');
    const response = await fetch('/api/products/export', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    if (!response.ok) throw new Error('Failed to export products');
    
    const blob = await response.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'products-export.csv';
    document.body.appendChild(a);
    a.click();
    window.URL.revokeObjectURL(url);
    document.body.removeChild(a);
    
    showToast('‚úÖ Products exported successfully!', 'success');
    
  } catch (error) {
    console.error('Error exporting products:', error);
    showToast('‚ùå Failed to export products', 'error');
  }
}

// Initialize admin check when page loads
document.addEventListener('DOMContentLoaded', function() {
  checkAdminStatus();
  // ... existing initialization code
});
    </script>
</body>
</html>